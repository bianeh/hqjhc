  <include file="Layout@Index:header" />
  <include file="Layout@Index:nav" />
  <script type="text/javascript" charset="utf-8" src="{$Think.const.ROOT_URL}/Public/common/plugins/editor/ueditor.config.js"></script>
  <script type="text/javascript" charset="utf-8" src="{$Think.const.ROOT_URL}/Public/common/plugins/editor/ueditor.all.min.js"> </script>
  <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
  <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
  <script type="text/javascript" charset="utf-8" src="{$Think.const.ROOT_URL}/Public/common/plugins/editor/lang/zh-cn/zh-cn.js"></script>
  <style>
/*  .formspec{
    display: none;
  }*/
  .form-group{
    margin-top: 5px;
    margin-bottom:1px;
  }
  .br{
    height: 5px;
  }
  .xinhao{
     color:red;
  }
  .ggtitle{
      
  }
/*  .weight{
      display:none;
  }
  .googds_erama{
      diplay:none;
  }*/
  </style>
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        产品添加
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> 后台</a></li>
        <li><a href="{:U('Product/Index/index')}">产品管理</a></li>
        <li class="active">添加产品</li>
      </ol>
    </section>
    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-xs-12">
          <div class="box">
            <div class="box-header">
              <h3 class="box-title">产品添加</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <div class="box box-warning">
            <!-- /.box-header -->
            <div class="box-body">
              <form role="form" id="addProduct" method="post" action="{:U('Product/Index/doAddProduct')}">
                <!-- text input -->
                <div class="form-group">
                    <span class="xinhao">*</span><label>商品名称</label>
                  <input type="text" id="name" name="name" class="form-control" placeholder="商品名称">
                </div>
                 <div class="form-group">
                  <span class="xinhao">*</span><label>供货商昵称</label>
                  <input type="text" id="offername" name="offername" class="form-control" placeholder="供货商昵称">
                </div>
                <div class="form-group">
                  <span class="xinhao">*</span><label>商品编号</label>
                  <input type="text" id="code_num" name="code_num" class="form-control" placeholder="商品编号">
                </div>
                <div class="form-group">
                  <label>商品一级分类</label>
                  <select multiple="" name="goodsCatIdfirst" class="form-control">
                  <option value=''>请选择</option>
                  <volist name="goodscatslist" id="vo">
                       <option class="goodscats" value="{$vo.catid}">{$vo.catname}</option>
                  </volist>
                  </select>
                </div>
                  <div class="form-group">
                  <label>商品二级分类</label>
                  <select multiple="" name="goodsCatIdmiddle" class="form-control childtwo">
                  </select>
                </div>
                <div class="form-group">
                  <label>商品三级分类</label>
                  <select multiple="" name="goodsCatIdlast" class="form-control childthree">
                  </select>
                </div>
                
<!--                <div class="form-group">
                  <label>规格模板</label>
                  <select multiple="" name="" class="form-control">
                  <option value=''>请选择</option>
                  <volist name="templateinfo" id="vo">
                       <option class="item_id" value="{$vo.id}">{$vo.name}</option>
                  </volist>
                  </select>
                </div>
                <div class="form-group specattr2" style="border:1px solid #ddd;padding:10px" >
                    
                </div>-->
                <div class="form-group">
                  <label>
                  商品规格
                  </label>
                  <input type="hidden" value='1' name="isSpec" />
              </div>
              <div class="formspec row">
               <div class="form-group spec">
                    <div class="col-xs-12">
                           <div class="col-xs-11">
                           </div>
                           <button type="button" class="btn bg-olive btn-flat margin addspec"><i class="fa fa-fw fa-plus"></i>继续添加</button> 
                    </div>   
               </div>
               <div class="col-xs-12 br"></div>
               <div class="col-xs-12">
                    <div class="col-xs-2 ggtitle">
                         <span><span class="xinhao">*</span>自定义规格（尺寸/颜色）</span>
                  </div>
                  <div class="col-xs-2 ggtitle">
                         <span><span class="xinhao">*</span>自定义规格（尺寸/颜色）</span>
                  </div>
                  <div class="col-xs-1 ggtitle">
                         <span><span class="xinhao">*</span>会员价格（元）</span>
                  </div>
                  <div class="col-xs-1 ggtitle">
                         <span><span class="xinhao">*</span>库存</span>
                  </div>
                  <div class="col-xs-1 ggtitle">
                         <span>供货商价格(元)</span>
                  </div>
                   <div class="col-xs-2 ggtitle">
                         <span>条形码</span>
                  </div>
                  <div class="col-xs-2 ggtitle">
                         <span>商品重量（kg）</span>
                  </div>
                  <div class="col-xs-1 ggtitle">
                         <span>操作</span>
                  </div>
                     </div>
                 <div class="form-group spec col-xs-12">
                     
                  <div class="col-xs-2">
                  <input type="text" class="form-control" name="speca[]" placeholder="">
                  </div>
                  <div class="col-xs-2">
                  <input type="text" class="form-control" name="specb[]" placeholder="">
                  </div>
                  <div class="col-xs-1">
                  <input type="text" class="form-control" name="specPrice[]" placeholder="">
                  </div>
                  <div class="col-xs-1">
                  <input type="text" class="form-control" name="specnum[]" placeholder="">
                  </div>
                  <div class="col-xs-1">
                  <input type="text" class="form-control" name="offerPrice[]" placeholder="">
                  </div>
                     <div class="col-xs-2">
                  <input type="text" class="form-control" name="code[]" placeholder="">
                  </div>
                     <div class="col-xs-2">
                  <input type="text" class="form-control" name="weight[]" placeholder="">
                  </div>
                  <div class="col-xs-1">
                    <button type="button" class="btn-danger">删除</button> 
                  </div>
                </div>
              </div>
               <br>
                <span class="xinhao">*</span><label>商品市场价格</label>
                 <div class="input-group">
                  <input type="text" id="marketPrice" name="marketPrice" class="form-control" placeholder="商品市场价格">
                  <span class="input-group-addon">.00</span>
                </div>   
                <span class="xinhao">*</span><label>商品价格</label>
                <div class="input-group">
                  <input type="text" id="goods_price" name="goods_price" class="form-control" placeholder="商品价格">
                  <span class="input-group-addon">.00</span>
                </div>
                 <span class="xinhao">*</span><label>供货商价格</label>
                 <div class="input-group">
                  <input type="text" id="offersPrice" name="offersPrice" class="form-control" placeholder="供货商价格">
                  <span class="input-group-addon">.00</span>
                </div>
                 <span class="xinhao">*</span><label>商品库存</label>
                 <div class="input-group">
                  <input type="text" id="number" name="number" class="form-control" placeholder="商品库存">
                  <span class="input-group-addon">件</span>
                </div>
                 <div class="form-group">
                  <label>商品主图</label>
                  <input name="display_img"  onchange="readyup(this)" id="display_img" multiple="" type="file" class="form-control">
                  <div style="width:100px;height:80px;background: #dddddd;margin-top:3px">
                      <img id="show_display_img" height="80px" width="100px" src="{$Think.const.ROOT_URL}/Public/backend/dist/img/boxed-bg.jpg" />
                  </div>
                  <input type="hidden" name="goods_display_img" value=""/>
                </div>
                 <div class="form-group">
                  <label>
                  是否转发视频
                  </label>
                  <input type="radio" value='1' class="istv" name="istv"  />是
                  <input type="radio" value='0' class="istv"  checked name="istv" checked/>否
                  </div>
                  <div class="form-group tv" style="display:none">
                  <label>上传小视频</label>
                  <input name="other_imgs"  onchange="readyup(this)" id="other_imgs" multiple=""  type="file" class="form-control">
                  <!-- <div style="width:100px;height:80px;background: #dddddd;margin-top:3px">
                      <img id="show_other_img1" height="80px" width="100px" src="{$Think.const.PUBLIC_URL}/backend/dist/img/boxed-bg.jpg" />
                  </div> -->
                  <input type="hidden" name="goods_other_img1" value=""/>
                </div>
                <div class="form-group imgf">
                  <span class="xinhao">*</span><label>商品附图1</label>
                  <input name="other_img1"  onchange="readyup(this)" id="other_img1" multiple="" type="file" class="form-control">
                  <div style="width:100px;height:80px;background: #dddddd;margin-top:3px">
                      <img id="show_other_img1" height="80px" width="100px" src="{$Think.const.ROOT_URL}/Public/backend/dist/img/boxed-bg.jpg" />
                  </div>
                  <input type="hidden" name="goods_other_img1" value=""/>
                </div>

                <div class="form-group imgf">
                  <span class="xinhao">*</span><label>商品附图2</label>
                  <input name="other_img2"  onchange="readyup(this)" id="other_img2" multiple="" type="file" class="form-control">
                  <div style="width:100px;height:80px;background: #dddddd;margin-top:3px">
                      <img id="show_other_img2" height="80px" width="100px" src="{$Think.const.ROOT_URL}/Public/backend/dist/img/boxed-bg.jpg" />
                  </div>
                  <input type="hidden" name="goods_other_img2" value=""/>
                </div>

                <div class="form-group imgf">
                  <span class="xinhao">*</span><label>商品附图3</label>
                  <input name="other_img3"  onchange="readyup(this)" id="other_img3" multiple="" type="file" class="form-control">
                  <div style="width:100px;height:80px;background: #dddddd;margin-top:3px">
                      <img id="show_other_img3" height="80px" width="100px" src="{$Think.const.ROOT_URL}/Public/backend/dist/img/boxed-bg.jpg" />
                  </div>
                  <input type="hidden" name="goods_other_img3" value=""/>
                </div>


                <div class="form-group imgf">
                  <span class="xinhao">*</span><label>商品附图4</label>
                  <input name="other_img4"  onchange="readyup(this)" id="other_img4" multiple="" type="file" class="form-control">
                  <div style="width:100px;height:80px;background: #dddddd;margin-top:3px">
                      <img id="show_other_img4" height="80px" width="100px" src="{$Think.const.ROOT_URL}/Public/backend/dist/img/boxed-bg.jpg" />
                  </div>
                  <input type="hidden" name="goods_other_img4" value=""/>
                </div>

                <div class="form-group">
                  <label>商品单位</label>
                  <input type="text" id="unit" name="unit" class="form-control" placeholder="商品单位">
                </div>
                <div class="form-group">
                  <span class="xinhao">*</span><label>单次最多购买数量</label>
                  <input type="text" id="once_shop_maxnum" name="once_shop_maxnum" class="form-control" placeholder="单次最多购买数量">
                </div>
                <div class="form-group">
                  <span class="xinhao">*</span><label>个人最多购买数量</label>
                  <input type="text" id="user_shop_maxnum" name="user_shop_maxnum" class="form-control" placeholder="个人最多购买数量">
                </div>
                 <div class="form-group">
                  <label>排序</label>
                  <input type="text" id="user_shop_maxnum" name="sort" class="form-control" placeholder="排序">
                </div>
               <div class="form-group">
                  <label>
                  是否包邮
                  </label>
                  <input type="radio" value='0'  class="freight" name="freight" checked />是
                  <input type="radio" value='1'  class="freight" name="freight" />否
              </div>
                <div class="form-group freightmb" style="display:none">
                  <label>运输模板</label>
                  <select multiple="" name="templateid" class="form-control">
                    <volist name="goodstemplatelist" id="vo">
                    <option value="{$vo.template_id}">{$vo.template_name}</option>
                    </volist>
                  </select>
                </div>
                <div class="form-group">
                  <span class="xinhao">*</span><label>商品品牌</label>
                  <select multiple="" name="brandid" class="form-control">
                    <volist name="brandslist" id="vo">
                        <option value="{$vo.brandid}">{$vo.brandname}</option>
                    </volist>
                  </select>
                </div>           
                <div class="form-group">
                  <span class="xinhao">*</span><label>商品类型</label>
                  <select multiple="" name="type" class="form-control">
                    <option>实体商品</option>
                    <option>虚拟商品</option>
                    <option>虚拟物品（卡密）</option>
                  </select>
                </div>
                <div class="form-group">
                  <span class="xinhao">*</span><label>商品描述</label>
                  <script id="editor" name="description" type="text/plain" style="width:100%;height:500px;"></script>
                </div>
                <div class="form-group">
                  <label>
                  是否精品
                  </label>
                  <input type="radio" value='1'  name="isBest"  />是
                  <input type="radio" value='0'  name="isBest" checked/>否
              </div>
              <div class="form-group">
                  <label>
                  是否新品
                  </label>
                  <input type="radio" value='1'  name="isNew"  />是
                  <input type="radio" value='0'  name="isNew" checked/>否
              </div>
              <div class="form-group">
                  <label>
                  是否推荐
                  </label>
                  <input type="radio" value='1'  name="isRecom"  />是
                  <input type="radio" value='0'  name="isRecom" checked/>否
              </div>
              <input type="hidden" name="createstaffid" value='{$data.stffid}'/>
              </form>
                <div class="form-group">
                    <button id="addProductOperate" class="btn bg-olive btn-flat margin"><i class="fa fa-fw fa-plus"></i>添加</button>
                </div>
            </div>
            <!-- /.box-body -->
          </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
          <!-- /.box -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
  </div>
  <include file="Layout@Index:footer"/>
  <!-- 全局js -->
  <script src="{$Think.const.ROOT_URL}/Public/common/js/jquery.min.js?v=2.1.4"></script>
  <script src="{$Think.const.ROOT_URL}/Public/common/js/bootstrap.min.js?v=3.3.6"></script>
  <script src="{$Think.const.ROOT_URL}/Public/common/js/ajaxfileupload.js"></script>
  <script>
      var offername = document.getElementById('offername');
      offername.onblur = function()
      {
          var offerloginName = offername.value;
          $.ajax({
             method:"POST",
             url:"{:U('Product/Index/check_offers')}",
             data:{offerloginName:offerloginName}
           }).done(function(msg){
               var data = JSON.parse(msg);
               var code = data['code'];
               if(code == '000000')
               {
                   alert('请填写正确的供货商信息！');
               }
           });
          
      }
  </script>
  <script>
    var ue = UE.getEditor('editor');
    var addProductOperate = document.getElementById("addProductOperate");
    addProductOperate.onclick=function()
    {     
          var name = document.getElementById("name");
          var code_num = document.getElementById("code_num");
          var goods_price = document.getElementById("goods_price");
          var marketPrice = document.getElementById("marketPrice");
          var number = document.getElementById('number');
          var once_shop_maxnum = document.getElementById('once_shop_maxnum');
          var user_shop_maxnum = document.getElementById('user_shop_maxnum');
          var goods_price_val = goods_price.value;
          var marketPrice_val = marketPrice.value;
          var code_num_val = code_num.value;
          var name_val = name.value;
          var number_val = number.value;
          var once_shop_maxnum_val = once_shop_maxnum.value;
          var user_shop_maxnum_val = user_shop_maxnum.value;
          if(name_val != "")
          {   
              if(code_num_val != "")
              {   
                  if(goods_price_val != '')
                  {   if(marketPrice_val != '')
                      {   
                          if(number_val != '')
                          {   
                              if(once_shop_maxnum_val != '')
                              {   
                                  if(user_shop_maxnum_val != '')
                                  {
                                      document.getElementById("addProduct").submit();
                                  }else
                                  {
                                      alert('个人最多购买的数量不能为空！');
                                  }
                                  
                              }else
                              {
                                  alert('单次最多购买的数量不能为空！');
                              }
                              
                          }else{
                              alert('商品库存不能为空！');
                          }
                          
                      }else
                      {
                          alert('商品市场价格不能为空！');
                      }
                      
                  }else{
                      alert('商品价格不能为空！');
                  }
                  
              }else{
                  alert('商品条形码不能为空！');
              }
          }else{
              alert('商品名称不能为空！');
          }
          
    }
    $(document).ready(function(){
       $(".goodscats").click(function(){
            var val = $(this).val();
            $.ajax({
             method:"POST",
             url:"{:U('Product/Index/getgoodscatschild')}",
             data:{catid:val}
           }).done(function(msg){
               $(".childtwo option").remove(); 
               $(".childthree option").remove();
               $(".childtwo").append(msg);
           });
       });
        $("body").on('click','.goodscatstwo',function(){
            var val = $(this).val();
            $.ajax({
             method:"POST",
             url:"{:U('Product/Index/getgoodscatschildtwo')}",
             data:{catid:val}
           }).done(function(msg){
               $(".childthree option").remove();
               $(".childthree").append(msg);
           });
        });
        
        $(".item_id").click(function(){
             var item_id = $(this).val();
             $.ajax({
             method:"POST",
             url:"{:U('Product/Index/getattrvalinfo')}",
             data:{item_id:item_id}
             }).done(function(msg){
               var data = JSON.parse(msg);
               var str1 = data['str1']; 
               $(".specattr2").html(str1);
           });
        });

        $("body").on('click','.specselect',function(){
          var val = $(this).val();
          if(val == 1)
          {
            $(".formspec").css("display","block");
            $(".weight").css("display","none");
            $(".googds_erama").css("display","none");
          }
          if(val == 0)
          {
            $(".formspec").css("display","none");
            $(".weight").css("display","block");
            $(".googds_erama").css("display","block");
          }
        });


        var  specselect_val = $("input[name='isSpec']:checked").val();
        if(specselect_val == 1)
        {
           $(".formspec").css("display","block");
        }
        

        $("body").on('click','.istv',function(){
          var val = $(this).val();
          if(val == 1)
          {
            $(".tv").css("display","block");
            $(".imgf").css("display","none");
          }
          if(val == 0)
          {
            $(".tv").css("display","none");
            $(".imgf").css("display","block");
          }
        });
        $("body").on('click','.addspec',function(){
           $(".formspec").append("<div class= col-xs-12 form-group spec  ><div class=col-xs-2 ><input type=text name=speca[] class=form-control placeholder=></div><div class=col-xs-2><input type=text name=specb[] class=form-control placeholder=></div><div class=col-xs-1><input type=text class=form-control name=specPrice[] placeholder=></div><div class=col-xs-1><input type=text class=form-control name=specnum[] placeholder=></div><div class=col-xs-1><input type=text name=offerPrice[] class=form-control placeholder=></div><div class=col-xs-2><input type=text name=code[] class=form-control placeholder=></div><div class=col-xs-2><input type=text name=weight[] class=form-control placeholder=></div><div class=col-xs-1><button type=button class='btn-danger'>删除</button></div></div><div class=col-xs-12 br></div>");
        });

        $(".freight").click(function(){
            var freight_val = $(this).val();
            if(freight_val == 1)
            {
              $(".freightmb").css("display","block");
            }
            if(freight_val == 0)
            {
              $(".freightmb").css("display","none");
            }
        });
        var freight_val = $("input[name='freight']:checked").val();
        if(freight_val == 1)
        {
           $(".freightmb").css("display","block");
        }
        $("body").on('click','.btn-danger',function(){
            $(this).parent().parent('div').remove();
        });
    });
  </script>
  <script>
      function readyup(obj)
    {       
            var id = obj.id;
            ajaxFileUpload(id);
    }
    function ajaxFileUpload(id) 
    {
            var Img_show = "show_"+id;
            $.ajaxFileUpload
            (
                    {
                        url: "{:U('Upload/Index/upload_product')}?id="+id,
                        secureuri: false,
                        fileElementId: id,
                        dataType: 'json',
                        success: function (data, status)
                        {  
                           var code = data['code'];
                           if(code == '000000')
                           {
                               alert('图片尺寸必须是640 X 640！');
                               return;
                           }
                           if(code == '000002')
                           {
                               $("#"+Img_show).attr("src", data.showimgurl);
                               $(":input[name=goods_"+id+"]").val(data.imgurl);
                           }
                        },
                        error: function (data, status, e)
                        {
                          alert(data.msg);
                        }
                    }
            )
            return false;
        }
  </script>